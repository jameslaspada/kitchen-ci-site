<html lang=en> <!--[if lt IE 7]>html.no-js.lt-ie9.lt-ie8.lt-ie7 lang="en"<![endif]--> <!--[if IE 7]>html.no-js.lt-ie9.lt-ie8 lang="en"<![endif]--> <!--[if IE 8]>html.no-js.lt-ie9 lang="en"<![endif]--> <!--[if (gte IE 8)]><html class=no-js><![endif]--> 
<!-- Mirrored from kitchen.ci/blog/test-kitchen-1-4-0-release-notes/ by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 17 Aug 2015 23:12:37 GMT -->
<head> <meta charset=utf-8> <meta content='IE=edge' http-equiv=X-UA-Compatible> <title> Test Kitchen 1.4.0 Release Notes - KitchenCI </title> <meta content='Test Kitchen' name=description> <meta content='Fletcher Nichol' name=author> <meta content='width=device-width, initial-scale=1.0' name=viewport> <link rel=alternate type="application/atom+xml" title="Atom Feed" href="../feed.xml"/> <link href="../../css/kitchen-26ac5aa6.css" media=screen rel=stylesheet /> <link href="http://fonts.googleapis.com/css?family=Open+Sans+Condensed:300,700" media=screen rel=stylesheet /> <link href="http://fonts.googleapis.com/css?family=Open+Sans" media=screen rel=stylesheet /> <link href="http://fonts.googleapis.com/css?family=Inconsolata" media=screen rel=stylesheet /> </head> <body> <!--[if lt IE 7]><p class=browsehappy>You are using an <strong>outdated</strong> browser. Please <a href='//browsehappy.com/'>upgrade your browser</a> to improve your experience.</p><![endif]--> <nav class='navbar navbar-inverse navbar-fixed-top' role=navigation> <div class=container> <div class=navbar-header> <div class='button navbar-toggle' data-target='.navbar-collapse' data-toggle=collapse type=button> <span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span> </div> <a class=navbar-brand href="../../index.html">KitchenCI</a> </div> <div class='navbar-collapse collapse'> <ul class='nav navbar-nav'> <li class=''> <a href="../../index.html">Home</a> </li> <li class=''> <a href="../index.html">Blog</a> </li> <li class=''> <a href="../../docs/getting-started/index.html">Guide</a> </li> </ul> <ul class='nav navbar-nav navbar-right' id=contacts> <li> <a href='http://twitter.com/kitchenci'> <i class='fa fa-twitter'></i> </a> </li> <li> <a href='http://github.com/test-kitchen'> <i class='fa fa-github'></i> </a> </li> </ul> </div> </div> </nav> <div class=welcomewrap> <h1>Test Kitchen Blog</h1> </div> <div class='container blog'> <div class=row> <article class='col-md-12 col-sm-12'> <h2>Test Kitchen 1.4.0 Release Notes</h2> <p class=posted> by Fletcher Nichol on <time datatime=2015-04-28>Tuesday, April 28 2015</time> </p> <section> <p>For immediate release: <a href="https://github.com/test-kitchen/test-kitchen/releases/tag/v1.4.0">Test Kitchen 1.4.0</a> is available on <a href="https://rubygems.org/gems/test-kitchen">RubyGems</a>.&#x000A;</p>&#x000A;&#x000A;<table>&#x000A; <tbody>&#x000A; <tr>&#x000A; <td> </td>&#x000A; <td>Update 2015-05-08</td>&#x000A; </tr>&#x000A; <tr>&#x000A; <td> </td>&#x000A; <td><em>The installation section has been updated with a link to the ChefDK version that ships Test Kitchen 1.4.0</em></td>&#x000A; </tr>&#x000A; </tbody>&#x000A;</table>&#x000A;&#x000A;<p>Sitting down? Good, this could take a few minutes to read through. Today we're releasing version 1.4.0 of Test Kitchen with a little something for everyone. We have an aggressively reworked plugin system including 2 new plugin concepts (Transport and Verifiers), improved SSH resiliency when instances are booting, first steps at SSH compression to make converges quicker, better HTTP proxy support, a fully realized Windows story, and more.</p>&#x000A;&#x000A;<p>Let's dig in a little, shall we?</p>&#x000A;&#x000A;<h2 id=installing>Installing</h2>&#x000A;&#x000A;<p>If you use the ChefDK project, then upgrade to <a href="https://downloads.chef.io/chef-dk/">version 0.5.0</a> or later to get all the goodies!</p>&#x000A;&#x000A;<p>If you have a Ruby workflow with RubyGems and/or Bundler this won’t be too much work:</p>&#x000A;&#x000A;<p>Gem install with:</p>&#x000A;&#x000A;<pre class="highlight shell">gem install <span class="nb">test</span>-kitchen --version <span class="s2">"~&gt; 1.4"</span>&#x000A;gem install kitchen-vagrant --version <span class="s2">"~&gt; 0.17"</span>&#x000A;gem install winrm-transport <span class="c"># only needed if you want to spin up Windows instances</span>&#x000A;</pre>&#x000A;<p>To use in a project with Bundler, the following goes into your Gemfile:</p>&#x000A;&#x000A;<pre class="highlight ruby"><span class="n">gem</span> <span class="s2">"test-kitchen"</span><span class="p">,</span> <span class="s2">"~&gt; 1.4"</span>&#x000A;<span class="n">gem</span> <span class="s2">"kitchen-vagrant"</span><span class="p">,</span> <span class="s2">"~&gt; 0.17"</span>&#x000A;<span class="n">gem</span> <span class="s2">"winrm-transport"</span> <span class="c1"># only needed if you want to spin up Windows instances</span>&#x000A;</pre>&#x000A;<h2 id=windows>Windows!</h2>&#x000A;&#x000A;<p>Note that this release has the much-fabled "Windows guest support". How do you get started? At the moment getting Vagrant base box images of Windows is still a bit of a pain, but if you have access to one, here are the versions that should "just work":</p>&#x000A;&#x000A;<ul>&#x000A; <li>Windows Server 2012r2</li>&#x000A; <li>Windows Server 2012r2 Core (you will need .NET 4.5 installed however)</li>&#x000A; <li>Windows Server 2012 (your system/image must have the KB2842230 hotfix applied (https://support.microsoft.com/en-us/kb/2842230))</li>&#x000A; <li>Windows Server 2008r2</li>&#x000A; <li>Windows 8.1 Pro,Enterprise,etc.</li>&#x000A; <li>Windows 8 Pro,Enterprise,etc. (your system/image must have the KB2842230 hotfix applied (https://support.microsoft.com/en-us/kb/2842230))</li>&#x000A; <li>Windows 7</li>&#x000A;</ul>&#x000A;&#x000A;<p>For a more in-depth example of getting started with Test Kitchen and Windows check out the <a href="../test-kitchen-windows-test-flight-with-vagrant.html">Windows Test Flight with Vagrant</a> blog post.</p>&#x000A;&#x000A;<p>Let’s take a peek at some of the other highlights…</p>&#x000A;&#x000A;<h2 id=other-highlights>Other Highlights</h2>&#x000A;&#x000A;<h3 id=self-aware-provisioners>Self-Aware Provisioners</h3>&#x000A;&#x000A;<p>This feature introduces a <code>#call(state)</code> method that exists in <code>Kitchen::Provisioner::Base</code> which will be invoked by Test Kitchen when the converge action is performed. For backwards compatibility, the same convergence "template" is used, relying on a small number of public methods that return command strings and 3 methods responsible for sandbox creation and cleanup.</p>&#x000A;&#x000A;<p>The high-level description of the default <code>#call(state)</code> method is as follows:</p>&#x000A;&#x000A;<ol>&#x000A; <li>Create the temporary sandbox on the workstation with "stuff" to transfer to the remote instance.</li>&#x000A; <li>Run the <code>#install_command</code> on the remote instance, if it is implemented.</li>&#x000A; <li>Run the <code>#init_command</code> on the remote instance, if it is implemented.</li>&#x000A; <li>Transfer all files in the sandbox path to the remote instance's configured <code>:root_path</code>.</li>&#x000A; <li>Run the <code>#prepare_command</code> on the remote instance, if it is implemented.</li>&#x000A; <li>Run the <code>#run_command</code> on the remote instance, if it is implemented.</li>&#x000A;</ol>&#x000A;&#x000A;<p>As a Provisioner author, you may elect to overwrite or partially re-implement the <code>#call(state)</code> method to do whatever you need in whatever order makes sense. This key difference allows Provisioner authors to entirely own the <code>kitchen converge</code> action and not rely on the Driver.</p>&#x000A;&#x000A;<h3 id=potentially-breaking-provisioners-responsible-for-converge-action>(Potentially Breaking) Provisioners responsible for converge action</h3>&#x000A;&#x000A;<p>This is potentially breaking to Driver authors if all of the following are true:</p>&#x000A;&#x000A;<ul>&#x000A; <li>Your Driver currently directly inherits from <code>Kitchen::Driver::Base</code></li>&#x000A; <li>Your Driver implements/overrides the <code>#converge</code> method</li>&#x000A;</ul>&#x000A;&#x000A;<p>Put another way, your Driver may have issues if it looks like the following:</p>&#x000A;&#x000A;<pre class="highlight ruby"><span class="k">module</span> <span class="nn">Kitchen</span>&#x000A;  <span class="k">module</span> <span class="nn">Driver</span>&#x000A;    <span class="k">class</span> <span class="nc">MyDriver</span> <span class="o">&lt;</span> <span class="no">Kitchen</span><span class="o">::</span><span class="no">Driver</span><span class="o">::</span><span class="no">Base</span>&#x000A;      <span class="k">def</span> <span class="nf">converge</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>&#x000A;        <span class="c1"># custom converge work</span>&#x000A;      <span class="k">end</span>&#x000A;    <span class="k">end</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;<p>For the vast majority of open source Drivers in the wild, current behavior is maintained as they all inherit from <code>Kitchen::Driver::SSHBase</code>. This class has been cemented to preserve its current behavior, and Test Kitchen will invoke the <code>#converge</code> method for these Drivers.</p>&#x000A;&#x000A;<p>A future deprecation process may remove the <code>SSHBase</code> backwards compatibility, but not without plenty of lead time and warning. Due to the constraints of semantic versioning, by definition, this wouldn't occur before a 2.x codebase release.</p>&#x000A;&#x000A;<h3 id=potentially-breaking-transports-responsible-for-login-action>(Potentially Breaking) Transports responsible for login action</h3>&#x000A;&#x000A;<p>This is potentially breaking to Driver authors if all of the following are true:</p>&#x000A;&#x000A;<ul>&#x000A; <li>Your Driver currently inherits from <code>Kitchen::Driver::Base</code></li>&#x000A; <li>Your Driver implements/overrides the <code>#login_command</code> method</li>&#x000A;</ul>&#x000A;&#x000A;<p>Put another way, your Driver may have issues if it looks like the following:</p>&#x000A;&#x000A;<pre class="highlight ruby"><span class="k">module</span> <span class="nn">Kitchen</span>&#x000A;  <span class="k">module</span> <span class="nn">Driver</span>&#x000A;    <span class="k">class</span> <span class="nc">MyDriver</span> <span class="o">&lt;</span> <span class="no">Kitchen</span><span class="o">::</span><span class="no">Driver</span><span class="o">::</span><span class="no">Base</span>&#x000A;      <span class="k">def</span> <span class="nf">login_command</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>&#x000A;        <span class="c1"># custom converge work</span>&#x000A;      <span class="k">end</span>&#x000A;    <span class="k">end</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;<p>For the vast majority of open source Drivers in the wild, current behavior is maintained as they all inherit from <code>Kitchen::Driver::SSHBase</code>. This class has been cemented to preserve its current behavior, and Test Kitchen will invoke the <code>#login_command</code> method for these Drivers.</p>&#x000A;&#x000A;<h3 id=self-aware-verifiers>Self-Aware Verifiers</h3>&#x000A;&#x000A;<p>This feature introduces a <code>#call(state)</code> method that exists in <code>Kitchen::Verifier::Base</code> which will be invoked by Test Kitchen when the verify action is performed. The setup action which previously installed the Busser gem and plugins, becomes a dummy or "no-op" action. In other words all previous behavior in the setup action now takes place in the verify action. For backwards compatibility, the same verify "template" is used, relying on a small number of public methods that return strings and 3 new methods responsible for sandbox creation and cleanup (with a very similar implementation to that in Provisioners).</p>&#x000A;&#x000A;<p>The high-level description of the default <code>#call(state)</code> method is as follows:</p>&#x000A;&#x000A;<ol>&#x000A; <li>Create the temporary sandbox on the workstation with "stuff" to transfer to the remote instance.</li>&#x000A; <li>Run the <code>#install_command</code> on the remote instance, if it is implemented.</li>&#x000A; <li>Run the <code>#init_command</code> on the remote instance, if it is implemented.</li>&#x000A; <li>Transfer all files in the sandbox path to the Verifier's configured <code>:root_path</code> on the remote instance.</li>&#x000A; <li>Run the <code>#prepare_command</code> on the remote instance, if it is implemented.</li>&#x000A; <li>Run the <code>#run_command</code> on the remote instance, if it is implemented.</li>&#x000A;</ol>&#x000A;&#x000A;<p>As a Verifier author, you may elect to overwrite or partially re-implement the <code>#call(state)</code> method to do whatever you need in whatever order makes sense. This key difference allows Verifier authors to entirely own the <code>kitchen verify</code> action and not rely on the Driver.</p>&#x000A;&#x000A;<h3 id=potentially-breaking-verifiers-responsible-for-verify-action>(Potentially Breaking) Verifiers responsible for verify action</h3>&#x000A;&#x000A;<p>This is a potentially breaking change to Driver authors if all of the following are true:</p>&#x000A;&#x000A;<ul>&#x000A; <li>Your Driver currently directly inherits from <code>Kitchen::Driver::Base</code></li>&#x000A; <li>Your Driver implements/overrides the <code>#setup</code> and/or <code>#verify</code> methods</li>&#x000A;</ul>&#x000A;&#x000A;<p>Put another way, your Driver may have issues if it looks like the following:</p>&#x000A;&#x000A;<pre class="highlight ruby"><span class="k">module</span> <span class="nn">Kitchen</span>&#x000A;  <span class="k">module</span> <span class="nn">Driver</span>&#x000A;    <span class="k">class</span> <span class="nc">MyDriver</span> <span class="o">&lt;</span> <span class="no">Kitchen</span><span class="o">::</span><span class="no">Driver</span><span class="o">::</span><span class="no">Base</span>&#x000A;      <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>&#x000A;        <span class="c1"># custom setup work</span>&#x000A;      <span class="k">end</span>&#x000A;&#x000A;      <span class="k">def</span> <span class="nf">verify</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>&#x000A;        <span class="c1"># custom verify work</span>&#x000A;      <span class="k">end</span>&#x000A;    <span class="k">end</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;<p>For the vast majority of open source Drivers in the wild, current behavior is maintained as they all inherit from <code>Kitchen::Driver::SSHBase</code>. This class has been cemented to preserve its current behavior, and Test Kitchen will invoke the <code>#setup</code> and <code>#verify</code> methods for these Drivers.</p>&#x000A;&#x000A;<h3 id=add-platform-ostype-for-instance-path-type-hinting>Add Platform <code>:os_type</code> for instance path type hinting</h3>&#x000A;&#x000A;<p>A new configurable attribute is introduced to a Platform entry called <code>:os_type</code>. For example:</p>&#x000A;&#x000A;<pre class="highlight yaml"><span class="nn">---</span>&#x000A;<span class="s">driver</span><span class="pi">:</span>&#x000A;  <span class="s">name</span><span class="pi">:</span> <span class="s">docker</span>&#x000A;&#x000A;<span class="s">provisioner</span><span class="pi">:</span>&#x000A;  <span class="s">name</span><span class="pi">:</span> <span class="s">chef_zero</span>&#x000A;&#x000A;<span class="s">platforms</span><span class="pi">:</span>&#x000A;  <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">ubuntu-14.04</span>&#x000A;    <span class="s">os_type</span><span class="pi">:</span> <span class="s">unix</span>&#x000A;  <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">windows-8.1</span>&#x000A;    <span class="s">os_type</span><span class="pi">:</span> <span class="s">windows</span>&#x000A;</pre>&#x000A;<p>The interpretation of <code>:os_type</code> is very narrowly defined as follows:</p>&#x000A;&#x000A;<ul>&#x000A; <li><code>"windows"</code> means a Windows operating system, requiring Windows paths such as <code>"C:\\Users"</code>, <code>"$env:TEMP\\stuff"</code>, or <code>"%TEMP%\\more"</code>.</li>&#x000A; <li><code>"unix"</code> means a non-Windows operating system, or UNIX derivative–the implication is essentially the same. This implies unix-style paths such as <code>"some/path/"</code> or "<code>/absolute/paths/are/nice</code>".</li>&#x000A; <li><code>nil</code> or unset will default to meaning <code>"unix"</code> to ensure backwards compatibility if values are somehow not properly passed in.</li>&#x000A; <li>Any other value will be passed down into the system, and allows for some future operating system support or a flag for bizarre custom behavior. This part is where dragons live.</li>&#x000A;</ul>&#x000A;&#x000A;<h3 id=add-remote-host-shelltype-hinting-support>Add remote host <code>:shell_type</code> hinting support</h3>&#x000A;&#x000A;<p>Platform has a new method <code>#shell_type</code> which will normally return either <code>"powershell"</code> or <code>"bourne"</code> depending on the pre-declared capabilities of the remote instance. The implicit default will be <code>"bourne"</code> for backwards compatibility.</p>&#x000A;&#x000A;<h3 id=add-sudocommand-to-provisioners-verifiers--shellout>Add <code>:sudo_command</code> to Provisioners, Verifiers, &amp; ShellOut</h3>&#x000A;&#x000A;<p>In an effort to better support older distributions (such as CentOS 5), and other distributions which don't ship with sudo in <code>$PATH</code> (such as Solaris), a new configuration attribute is introduced into <code>Provisioner::Base</code> and <code>Verifier::Base</code> called <code>:sudo_command</code>. For greatest portability and backwards compatibility this defaults to <code>"sudo -E"</code> but is now customizable depending on your situation.</p>&#x000A;&#x000A;<p>For example:</p>&#x000A;&#x000A;<pre class="highlight yaml"><span class="nn">---</span>&#x000A;<span class="s">driver</span><span class="pi">:</span>&#x000A;  <span class="s">name</span><span class="pi">:</span> <span class="s">vagrant</span>&#x000A;&#x000A;<span class="s">platforms</span><span class="pi">:</span>&#x000A;  <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">centos-7.0</span>                      <span class="c1"># defaults apply</span>&#x000A;  <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">centos-5.11</span>                     <span class="c1"># removes -E flag</span>&#x000A;    <span class="s">provisioner</span><span class="pi">:</span>&#x000A;      <span class="s">sudo_command</span><span class="pi">:</span> <span class="s">sudo</span>&#x000A;    <span class="s">verifier</span><span class="pi">:</span>&#x000A;      <span class="s">sudo_command</span><span class="pi">:</span> <span class="s">sudo</span>&#x000A;  <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">solaris-10</span>                      <span class="c1"># sets custom path to sudo</span>&#x000A;    <span class="s">provisioner</span><span class="pi">:</span>&#x000A;      <span class="s">sudo_command</span><span class="pi">:</span> <span class="s">/usr/local/bin/sudo</span>&#x000A;    <span class="s">verifier</span><span class="pi">:</span>&#x000A;      <span class="s">sudo_command</span><span class="pi">:</span> <span class="s">/usr/local/bin/sudo</span>&#x000A;</pre>&#x000A;<p>Note that a future feature proposes a way to remove the provisioner/verifier duplication but this would only be a convenience, not a behavior change.</p>&#x000A;&#x000A;<p>Finally, <code>Driver::Base</code> was not augmented with this configuration attribute as it is no longer responsible for creating the commands to execute on remote instances–this is now solely the purview of Provisioner and Verifier plugins.</p>&#x000A;&#x000A;<h3 id=add-plugin-diagnostics-exposed-via-kitchen-diagnose>Add plugin diagnostics, exposed via <code>kitchen diagnose</code></h3>&#x000A;&#x000A;<p>This feature adds a new flag to <code>kitchen diagnose</code>: <code>--plugins</code> which adds a <code>:plugins</code> hash to the diagnostic output. It is the unique set of all loaded Driver, Provisioner, Verifier, and Transport plugins which is keyed by the <code>#name</code> of the plugin.</p>&#x000A;&#x000A;<p>For example, a .kitchen.yml with the following configuration:</p>&#x000A;&#x000A;<pre class="highlight yaml"><span class="nn">---</span>&#x000A;<span class="s">driver</span><span class="pi">:</span>&#x000A;  <span class="s">name</span><span class="pi">:</span> <span class="s">vagrant</span>&#x000A;&#x000A;<span class="s">provisioner</span><span class="pi">:</span>&#x000A;  <span class="s">name</span><span class="pi">:</span> <span class="s">chef_zero</span>&#x000A;&#x000A;<span class="s">verifier</span><span class="pi">:</span>&#x000A;  <span class="s">name</span><span class="pi">:</span> <span class="s">dummy</span>&#x000A;&#x000A;<span class="s">platforms</span><span class="pi">:</span>&#x000A;  <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">ubuntu-14.04</span>&#x000A;    <span class="s">transport</span><span class="pi">:</span>&#x000A;      <span class="s">name</span><span class="pi">:</span> <span class="s">ssh</span>&#x000A;  <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">centos-7.0</span>&#x000A;    <span class="s">driver</span><span class="pi">:</span>&#x000A;      <span class="s">name</span><span class="pi">:</span> <span class="s">docker</span>&#x000A;    <span class="s">transport</span><span class="pi">:</span>&#x000A;      <span class="s">name</span><span class="pi">:</span> <span class="s">ssh</span>&#x000A;  <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">windows-2012r2-core</span>&#x000A;    <span class="s">transport</span><span class="pi">:</span>&#x000A;      <span class="s">name</span><span class="pi">:</span> <span class="s">winrm</span>&#x000A;</pre>&#x000A;<p>with an invocation of <code>kitchen diagnose --plugins</code> would produce a diagnostic output similar to:</p>&#x000A;&#x000A;<pre class="highlight yaml"><span class="nn">---</span>&#x000A;<span class="s">timestamp</span><span class="pi">:</span> <span class="s">2015-03-28 00:43:32 UTC</span>&#x000A;<span class="s">kitchen_version</span><span class="pi">:</span> <span class="s">1.4.0.dev</span>&#x000A;<span class="s">plugins</span><span class="pi">:</span>&#x000A;  <span class="s">driver</span><span class="pi">:</span>&#x000A;    <span class="s">Docker</span><span class="pi">:</span>&#x000A;      <span class="s">class</span><span class="pi">:</span> <span class="s">Kitchen::Driver::Docker</span>&#x000A;    <span class="s">Vagrant</span><span class="pi">:</span>&#x000A;      <span class="s">class</span><span class="pi">:</span> <span class="s">Kitchen::Driver::Vagrant</span>&#x000A;  <span class="s">provisioner</span><span class="pi">:</span>&#x000A;    <span class="s">ChefZero</span><span class="pi">:</span>&#x000A;      <span class="s">class</span><span class="pi">:</span> <span class="s">Kitchen::Provisioner::ChefZero</span>&#x000A;  <span class="s">transport</span><span class="pi">:</span>&#x000A;    <span class="s">Ssh</span><span class="pi">:</span>&#x000A;      <span class="s">class</span><span class="pi">:</span> <span class="s">Kitchen::Transport::Ssh</span>&#x000A;    <span class="s">Winrm</span><span class="pi">:</span>&#x000A;      <span class="s">class</span><span class="pi">:</span> <span class="s">Kitchen::Transport::Winrm</span>&#x000A;  <span class="s">verifier</span><span class="pi">:</span>&#x000A;    <span class="s">Dummy</span><span class="pi">:</span>&#x000A;      <span class="s">class</span><span class="pi">:</span> <span class="s">Kitchen::Verifier::Dummy</span>&#x000A;</pre>&#x000A;<h3 id=add-keepalive--keepaliveinterval-attributes-to-ssh-transport>Add <code>:keepalive</code> &amp; <code>:keepalive_interval</code> attributes to SSH Transport</h3>&#x000A;&#x000A;<p>By default, keepalive packets are enabled with a 60-second interval. Both of these settings are configurable in a transport block, such as:</p>&#x000A;&#x000A;<pre class="highlight yaml"><span class="nn">---</span>&#x000A;<span class="s">driver</span><span class="pi">:</span>&#x000A;  <span class="s">name</span><span class="pi">:</span> <span class="s">vagrant</span>&#x000A;&#x000A;<span class="s">provisioner</span><span class="pi">:</span>&#x000A;  <span class="s">name</span><span class="pi">:</span> <span class="s">chef_zero</span>&#x000A;&#x000A;<span class="s">transport</span><span class="pi">:</span>&#x000A;  <span class="s">name</span><span class="pi">:</span> <span class="s">ssh</span>&#x000A;  <span class="s">keepalive</span><span class="pi">:</span> <span class="s">true</span>&#x000A;  <span class="s">keepalive_interval</span><span class="pi">:</span> <span class="s">5</span>&#x000A;&#x000A;<span class="s">platforms</span><span class="pi">:</span>&#x000A;  <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">ubuntu-14.04</span>&#x000A;&#x000A;<span class="s">suites</span><span class="pi">:</span>&#x000A;  <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">default</span>&#x000A;</pre>&#x000A;<h3 id=add-default-compression--compressionlevel-attributes-to-ssh-transport>Add default <code>:compression</code> &amp; <code>:compression_level</code> attributes to SSH Transport</h3>&#x000A;&#x000A;<p>There are 2 new configuration attributes for all SSH Transports:</p>&#x000A;&#x000A;<ul>&#x000A; <li><code>:compression</code> - can be set to <code>"zlib"</code> or <code>"none"</code>, default is <code>"zlib"</code></li>&#x000A; <li><code>:compression_level</code> - can be set to a number between 0 and 9 where 0 is uncompressed and 9 is maximum compression, default is <code>9</code></li>&#x000A;</ul>&#x000A;&#x000A;<p>These values are passed directly into the <a href="https://github.com/net-ssh/net-ssh/blob/95e2a9404957517061492d880ed7278700e9ad2c/lib/net/ssh.rb#L106-L108">net-ssh</a> library when being invoked.</p>&#x000A;&#x000A;<h3 id=increased-http-proxy-support-for-executing-commands>Increased HTTP proxy support for executing commands</h3>&#x000A;&#x000A;<p>This release also added more a complete strategy for HTTP proxy variable setting. If both <code>:http_proxy</code> and <code>:https_proxy</code> are set, then the following Bourne shell environment variables are exported:</p>&#x000A;&#x000A;<ul>&#x000A; <li><code>http_proxy</code></li>&#x000A; <li><code>HTTP_PROXY</code></li>&#x000A; <li><code>https_proxy</code></li>&#x000A; <li><code>HTTPS_PROXY</code></li>&#x000A;</ul>&#x000A;&#x000A;<p>And the following PowerShell environment variables are set:</p>&#x000A;&#x000A;<ul>&#x000A; <li><code>$env:http_proxy</code></li>&#x000A; <li><code>$env:HTTP_PROXY</code></li>&#x000A; <li><code>$env:https_proxy</code></li>&#x000A; <li><code>$env:HTTPS_PROXY</code></li>&#x000A;</ul>&#x000A;&#x000A;<p>These environment variables will be set for every command executed in the Chef-related and Shell Provisioners, as well as the Busser Verifier.</p>&#x000A;&#x000A;<p>The Bourne shell environment variable setting has also changed. Previously they were set with an <code>env</code> prepended to the <code>sh -c '...'</code> wrapped command. Now these environment variables are set inside the <code>sh -c '...'</code> at the top and are exported.</p>&#x000A;&#x000A;<p>For example running <code>wget "http://chef.io/chef/install.sh"</code> with <code>:http_proxy</code> and <code>:https_proxy</code> set would generate a command similar to:</p>&#x000A;&#x000A;<pre class="highlight shell">sh -c <span class="s1">'&#x000A;http_proxy="http://proxy"; export http_proxy&#x000A;HTTP_PROXY="http://proxy"; export HTTP_PROXY&#x000A;https_proxy="https://proxy"; export https_proxy&#x000A;HTTPS_PROXY="https://proxy"; export HTTPS_PROXY&#x000A;&#x000A;wget "http://chef.io/chef/install.sh"&#x000A;'</span>&#x000A;</pre>&#x000A;<h3 id=support-symbol-values-in-solorb-chefsolo--clientrb-chefzero>Support symbol values in solo.rb (chef_solo) &amp; client.rb (chef_zero)</h3>&#x000A;&#x000A;<p>This allows for settings such as the following to serialize correctly into <code>client.rb</code> or <code>solo.rb</code> (depending on the Provisioner). For example:</p>&#x000A;&#x000A;<pre class="highlight yaml"><span class="nn">---</span>&#x000A;<span class="s">driver</span><span class="pi">:</span>&#x000A;  <span class="s">name</span><span class="pi">:</span> <span class="s">vagrant</span>&#x000A;&#x000A;<span class="s">provisioner</span><span class="pi">:</span>&#x000A;  <span class="s">name</span><span class="pi">:</span> <span class="s">chef_zero</span>&#x000A;  <span class="s">client_rb</span><span class="pi">:</span>&#x000A;    <span class="s">ssl_verify_mode</span><span class="pi">:</span> <span class="s">:verify_none</span>&#x000A;&#x000A;<span class="s">platforms</span><span class="pi">:</span>&#x000A;  <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">centos-7.0</span>&#x000A;&#x000A;<span class="s">suites</span><span class="pi">:</span>&#x000A;  <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">default</span>&#x000A;</pre>&#x000A;<h3 id=add-chefmetadataurl-to-chef-provisioners-for-windows-installs>Add <code>:chef_metadata_url</code> to Chef Provisioners for Windows installs</h3>&#x000A;&#x000A;<p>This configuration attribute is only used for Windows-based platforms and computes a suitable default based on:</p>&#x000A;&#x000A;<ul>&#x000A; <li>The base of the value of <code>:chef_omnibus_url</code></li>&#x000A; <li>The version information in <code>:require_chef_omnibus</code></li>&#x000A; <li>Any project info given in <code>:chef_omnibus_install_options</code></li>&#x000A;</ul>&#x000A;&#x000A;<p>For example, given the following YAML fragment:</p>&#x000A;&#x000A;<pre class="highlight yaml"><span class="nn">---</span>&#x000A;<span class="s">provisioner</span><span class="pi">:</span>&#x000A;  <span class="s">name</span><span class="pi">:</span> <span class="s">chef_zero</span>&#x000A;  <span class="s">require_chef_omnibus</span><span class="pi">:</span> <span class="s">12.1</span>&#x000A;&#x000A;<span class="s">platforms</span><span class="pi">:</span>&#x000A;  <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">windows-8</span>&#x000A;</pre>&#x000A;<p>would result in the latest 12.1.x Chef Omnibus package to be installed.</p>&#x000A;&#x000A;<p>Here's an example installing the ChefDK package instead of a vanilla Chef Omnibus package:</p>&#x000A;&#x000A;<pre class="highlight yaml"><span class="nn">---</span>&#x000A;<span class="s">provisioner</span><span class="pi">:</span>&#x000A;  <span class="s">name</span><span class="pi">:</span> <span class="s">chef_zero</span>&#x000A;  <span class="s">require_chef_omnibus</span><span class="pi">:</span> <span class="s">0.4</span>&#x000A;  <span class="s">chef_omnibus_install_options</span><span class="pi">:</span> <span class="s">-P chefdk</span>&#x000A;&#x000A;<span class="s">platforms</span><span class="pi">:</span>&#x000A;  <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">windows-8</span>&#x000A;    <span class="s">provisioner</span><span class="pi">:</span>&#x000A;      <span class="s">chef_omnibus_root</span><span class="pi">:</span> <span class="s">$env:systemdrive\opscode\chefdk</span>&#x000A;</pre>&#x000A;<h2 id=full-changeleog>Full Changeleog</h2>&#x000A;&#x000A;<p>(<em>This is a selected roll-up of 1.4.0 pre-release <a href="https://github.com/test-kitchen/test-kitchen/blob/master/CHANGELOG.md">changelogs</a></em>)</p>&#x000A;&#x000A;<h3 id=potentially-breaking-changes>Potentially breaking changes</h3>&#x000A;&#x000A;<p><strong>Note::</strong> while a huge amount of effort has gone into preserving backwards compatibility, there could be issues when running this release using certain Drivers and Provisioners, especially ones that are deeply customized. Drivers that inherit directly from <code>Kitchen::Driver::Base</code> may need to be updated, while Driver that inherit directly from <code>Kitchen::Driver::SSHBase</code> should continue to operate as before. Other libraries/addons/plugins which patch internals of Test Kitchen's code may break or work differently and would be extremely hard to preserve while adding new functionality. Sadly, this is a tradeoff.</p>&#x000A;&#x000A;<ul>&#x000A; <li>Drivers are no longer responsible for <code>converge</code>, <code>setup</code>, <code>verify</code>, and <code>login</code> actions. The updated Driver API contract (<a href="https://github.com/test-kitchen/test-kitchen/blob/master/lib/kitchen/driver/base.rb">Driver::Base</a>) only requires implementing the <code>#create</code> and <code>#destroy</code> methods, same as before. However, for Drivers that directly inherit from <code>Kitchen::Driver::Base</code>, any custom <code>#converge</code>, <code>#setup</code>, <code>#verify</code>, or <code>#login_command</code> methods will no longer be called. (<a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A; <li>Drivers which inherit directly from <code>Kitchen::Driver::SSHBase</code> are now considered "Legacy Drivers" as further improvements for these Drivers may not be available in future releases. The previous behavior is preserved, i.e. the Driver's <code>#converge</code>, <code>#setup</code>, and <code>#verify</code> methods are called and all methods signatures (and relative behavior) is preserved. (<a href="https://github.com/test-kitchen/test-kitchen/blob/master/lib/kitchen/driver/ssh_base.rb">Driver::SSHBase</a>, <a href="https://github.com/test-kitchen/test-kitchen/commit/d816d6fd1bd21548b485ca91e0ff9303e99a6fbc">Commit notes</a>) (<a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A; <li>Provisioners are now self-aware, completely owning the <code>converge</code> action. The original public methods of the Base Provisioner are maintained but are now invoked with a <code>#call(state)</code> method on the Provisioner object. Provisioner authors may elect to implement the command and sandbox methods, or re-implement the <code>#call</code> method which may not call any of the previously mentioned methods. (<a href="https://github.com/test-kitchen/test-kitchen/blob/master/lib/kitchen/provisioner/base.rb">Provisioner::Base</a>, <a href="https://github.com/test-kitchen/test-kitchen/commit/3196675e519a2fb97af4bcac80ef11f5e37f2537">Commit notes</a>) (<a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A; <li>Transport are not responsible for the <code>login</code> command. (<a href="https://github.com/test-kitchen/test-kitchen/commit/ae360a11d8c18ff5d1086ee19b099db1d0422024">Commit notes</a>) (<a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A; <li>Busser is now a plugin of type Verifier (see below for details on Verifiers). Any external code that directly creates a <code>Kitchen::Busser</code> object will fail as the class has moved to <code>Kitchen::Verifier::Busser</code>. Any external code that directly invokes Busser's <code>#sync_cmd</code> will log a warning and will <strong>not</strong> transfer test files (authors of plugins may now call <code>instance.transport(state).upload(locals, remote)</code> in its place). (<a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A; <li>Verifiers are responsible for the <code>verify</code> action. (<a href="https://github.com/test-kitchen/test-kitchen/commit/d62f577003c1920259eb627cc4479c0b21e0c374">Commit notes</a>) (<a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A; <li>Pull request <a href="https://github.com/test-kitchen/test-kitchen/issues/649">#649</a>: Preserve Busser's #setup_cmd, #run_cmd, &amp; #sync_cmd for better backwards compatibility. (<a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A; <li>Pull request <a href="https://github.com/test-kitchen/test-kitchen/issues/672">#672</a>: Extract WinRM-dependant code from Transport::Winrm into the winrm-transport gem, meaning that WinRM support is now a soft dependency of Test Kitchen, similar to Berkshelf and Librarian-Chef. This means the first time a Winrm Transport is requested, a <code>kitchen</code> command will crash with a UserError message instructing the user to install the winrm-transport gem. Existing projects which do not use the Winrm Transport will be unaffected and have no extra gem dependencies to manage. (<a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A;</ul>&#x000A;&#x000A;<h3 id=bug-fixes>Bug fixes</h3>&#x000A;&#x000A;<ul>&#x000A; <li>Issue <a href="https://github.com/test-kitchen/test-kitchen/issues/611">#611</a>, pull request <a href="https://github.com/test-kitchen/test-kitchen/issues/673">#673</a>: Ensure that secret key is deleted before converge for chef_zero and chef_solo Provisioners. (<a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A; <li>Issue <a href="https://github.com/test-kitchen/test-kitchen/issues/389">#389</a>, pull request <a href="https://github.com/test-kitchen/test-kitchen/issues/674">#674</a>: Expand path for <code>:ssh_key</code> if provided in kitchen.yml for Ssh Transport. (<a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A; <li>Pull request <a href="https://github.com/test-kitchen/test-kitchen/issues/653">#653</a>: Consider <code>:require_chef_omnibus = 11</code> to be a modern version for Chef Provisioners. (<a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A;</ul>&#x000A;&#x000A;<h3 id=new-features>New features</h3>&#x000A;&#x000A;<ul>&#x000A; <li>ChefZero Provisioner supports Windows paths and PowerShell commands and works with the WinRM Transport (default behavior for Platform names starting with <code>/^win/</code>). (<a href="https://github.com/test-kitchen/test-kitchen/blob/master/lib/kitchen/provisioner/chef_zero.rb">Provisioner::ChefZero</a>) (<a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A; <li>ChefSolo Provisioner supports Windows paths and PowerShell commands and works with the WinRM Transport (default behavior for Platform names starting with <code>/^win/</code>). (<a href="https://github.com/test-kitchen/test-kitchen/blob/master/lib/kitchen/provisioner/chef_solo.rb">Provisioner::ChefSolo</a>) (<a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A; <li>Shell Provisioner supports PowerShell scripts in addition to Bourne shell scripts (<a href="https://github.com/test-kitchen/test-kitchen/blob/master/lib/kitchen/provisioner/shell.rb">Provisioner::Shell</a>) (<a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A; <li>Platform operating system and shell hinting: By default, Windows platform names (case insensitive platform names starting with <code>/^win/</code>) will have <code>:os_type</code> set to <code>"windows"</code> and <code>:shell_type</code> set to <code>"powershell"</code>. By default, non-Windows platform names will have <code>:os_type</code> set to <code>"unix"</code> and <code>:shell_type</code> set to <code>"bourne"</code>. The methods <code>#windows_os?</code>, <code>#unix_os?</code>, <code>#powershell_shell?</code>, <code>#bourne_shell?</code>, and <code>#remote_path_join</code> are available for all Driver, Provisioner, Verifier, and Transport authors. (<a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A; <li>New plugin type: Transport, which executes commands and transfers files to remote instances. (<a href="https://github.com/test-kitchen/test-kitchen/blob/master/lib/kitchen/transport/base.rb">Transport::Base</a>) (<a href="https://github.com/afiune">@afiune</a>, <a href="https://github.com/mwrock">@mwrock</a>, <a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A; <li>New Transport: WinRM: which re-uses a remote shell to execute commands and upload files over WinRM. Currently non-SSL/plaintext authentication only. (<a href="https://github.com/test-kitchen/test-kitchen/blob/master/lib/kitchen/transport/winrm.rb">Transport::Winrm</a>) (<a href="https://github.com/afiune">@afiune</a>, <a href="https://github.com/mwrock">@mwrock</a>, <a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A; <li>New Transport: SSH, which re-uses one SSH connection where possible. Improvements such as keepalive, retries, and further configuration attributes are included. This replaces the more general <code>Kitchen:SSH</code> class, which remains in the codebase for plugins that call this class directly. (<a href="https://github.com/test-kitchen/test-kitchen/blob/master/lib/kitchen/transport/ssh.rb">Transport::Ssh</a>) (<a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A; <li>New plugin type: Verifier, which executes post-convergence tests on the instance. Busser is now a Verifier. (<a href="https://github.com/test-kitchen/test-kitchen/blob/master/lib/kitchen/verifier/base.rb">Verifier::Base</a>) (<a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A; <li>Add <a href=d8f1a7db9e506c44f321462e1fba0b1e24994070.html>API versioning</a> metadata to all plugin types. (<a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A; <li>Pull request <a href="https://github.com/test-kitchen/test-kitchen/issues/667">#667</a>, pull request <a href="https://github.com/test-kitchen/test-kitchen/issues/668">#668</a>: Add plugin diagnostics, exposed via <code>kitchen diagnose</code>. (<a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A; <li>Pull request <a href="https://github.com/test-kitchen/test-kitchen/issues/675">#675</a>, issue <a href="https://github.com/test-kitchen/test-kitchen/issues/424">#424</a>: Add default <code>:compression</code> &amp; <code>:compression_level</code> configuration attributes to Ssh Transport.</li>&#x000A; <li>Pull request <a href="https://github.com/test-kitchen/test-kitchen/issues/651">#651</a>, issue <a href="https://github.com/test-kitchen/test-kitchen/issues/592">#592</a>, issue <a href="https://github.com/test-kitchen/test-kitchen/issues/629">#629</a>, issue <a href="https://github.com/test-kitchen/test-kitchen/issues/307">#307</a>: Add :sudo_command to Provisioners, Verifiers, &amp; ShellOut. (<a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A;</ul>&#x000A;&#x000A;<h4 id=improvements>Improvements</h4>&#x000A;&#x000A;<ul>&#x000A; <li>In addition to supporting setting <code>http_proxy</code> and <code>https_proxy</code> environment variables when <code>:http_proxy</code> and <code>:https_proxy</code> are set in Provisioner and Verifier blocks, <code>HTTP_PROXY</code> and <code>HTTPS_PROXY</code> environment variables will also be set/exported in ChefZero/ChefSolo Provisioners and Busser Verifier. (<a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A; <li>Pull request <a href="https://github.com/test-kitchen/test-kitchen/issues/600">#600</a>, pull request <a href="https://github.com/test-kitchen/test-kitchen/issues/633">#633</a>, issue <a href="https://github.com/test-kitchen/test-kitchen/issues/85">#85</a>: Add <code>--log-overwrite</code> flag to CLI anywhere <code>--log-level</code> is accepted. By default it is true and will clear out the log every time Test Kitchen runs. To disable this behavior pass <code>--log-overwrite=false</code> or <code>--no-log-overwrite</code>. You can also configure this with the environment variable <code>KITCHEN_LOG_OVERWRITE</code>. (<a href="https://github.com/tyler-ball">@tyler-ball</a>)</li>&#x000A; <li>Refactor "non-trivial" (i.e. more than a line or two) Bourne and PowerShell code bodies into static files under support/ for better code review by domain experts. (<a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A; <li>Pull request <a href="https://github.com/test-kitchen/test-kitchen/issues/530">#530</a>, issue <a href="https://github.com/test-kitchen/test-kitchen/issues/429">#429</a>: Stop uploading empty directories. (<a href="https://github.com/whiteley">@whiteley</a>)</li>&#x000A; <li>Pull request <a href="https://github.com/test-kitchen/test-kitchen/issues/588">#588</a>: Change getchef.com to chef.io in ChefZero and ChefSolo Provisioners. (<a href="https://github.com/jdmundrawala">@jdmundrawala</a>)</li>&#x000A; <li>Pull request <a href="https://github.com/test-kitchen/test-kitchen/issues/658">#658</a>, issue <a href="https://github.com/test-kitchen/test-kitchen/issues/654">#654</a>: Updated for sh compatibility based on install.sh code which supports more platforms including Solaris. (<a href="https://github.com/scotthain">@scotthain</a>, <a href="https://github.com/curiositycasualty">@curiositycasualty</a>, <a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A; <li>Pull request <a href="https://github.com/test-kitchen/test-kitchen/issues/652">#652</a>, pull request <a href="https://github.com/test-kitchen/test-kitchen/issues/666">#666</a>, issue <a href="https://github.com/test-kitchen/test-kitchen/issues/556">#556</a>: Support symbol values in solo.rb &amp; client.rb for chef_zero and chef_solo Provisioners. (<a href="https://github.com/fnichol">@fnichol</a>)</li>&#x000A;</ul>&#x000A;&#x000A;&#x000A; </section> </article> </div> </div> <div id=footerwrap> <div class=container> <em>Made in North America</em> <p>&copy; 2013, <a href='http://heavywaterops.com/'>Heavy Water Operations, LLC (OR)</a>.</p> </div> </div> </body> <script src="../../js/vendor/modernizr-2.6.2.min-76c5a590.js"></script> <script src="../../js/all-126c4e27.js"></script> <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');
    
    ga('create', 'UA-39138312-3', 'kitchen.ci');
    ga('send', 'pageview');
  </script> 
<!-- Mirrored from kitchen.ci/blog/test-kitchen-1-4-0-release-notes/ by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 17 Aug 2015 23:12:38 GMT -->
</html>