<html lang=en> <!--[if lt IE 7]>html.no-js.lt-ie9.lt-ie8.lt-ie7 lang="en"<![endif]--> <!--[if IE 7]>html.no-js.lt-ie9.lt-ie8 lang="en"<![endif]--> <!--[if IE 8]>html.no-js.lt-ie9 lang="en"<![endif]--> <!--[if (gte IE 8)]><html class=no-js><![endif]--> 
<!-- Mirrored from kitchen.ci/docs/getting-started/running-converge by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 17 Aug 2015 23:12:38 GMT -->
<head> <meta charset=utf-8> <meta content='IE=edge' http-equiv=X-UA-Compatible> <title> Running Kitchen Converge - KitchenCI </title> <meta content='Test Kitchen' name=description> <meta content='Fletcher Nichol' name=author> <meta content='width=device-width, initial-scale=1.0' name=viewport> <link href="../../css/kitchen-26ac5aa6.css" media=screen rel=stylesheet /> <link href="http://fonts.googleapis.com/css?family=Open+Sans+Condensed:300,700" media=screen rel=stylesheet /> <link href="http://fonts.googleapis.com/css?family=Open+Sans" media=screen rel=stylesheet /> <link href="http://fonts.googleapis.com/css?family=Inconsolata" media=screen rel=stylesheet /> </head> <body> <!--[if lt IE 7]><p class=browsehappy>You are using an <strong>outdated</strong> browser. Please <a href='//browsehappy.com/'>upgrade your browser</a> to improve your experience.</p><![endif]--> <nav class='navbar navbar-inverse navbar-fixed-top' role=navigation> <div class=container> <div class=navbar-header> <div class='button navbar-toggle' data-target='.navbar-collapse' data-toggle=collapse type=button> <span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span> </div> <a class=navbar-brand href="../../index.html">KitchenCI</a> </div> <div class='navbar-collapse collapse'> <ul class='nav navbar-nav'> <li class=''> <a href="../../index.html">Home</a> </li> <li class=''> <a href="../../blog/index.html">Blog</a> </li> <li class=''> <a href="index.html">Guide</a> </li> </ul> <ul class='nav navbar-nav navbar-right' id=contacts> <li> <a href='http://twitter.com/kitchenci'> <i class='fa fa-twitter'></i> </a> </li> <li> <a href='http://github.com/test-kitchen'> <i class='fa fa-github'></i> </a> </li> </ul> </div> </div> </nav> <div class=welcomewrap> <h1>Getting Started Guide</h1> </div> <div class=progress> <div aria-valuemax=100 aria-valuemin=0 aria-valuenow=guide_progress class=progress-bar role=progressbar style='width: 25.0%;'> <span class=sr-only id='25.0% Complete'></span> </div> </div> <div class='container guide'> <div class=row> <div class='article col-sm-8 col-md-8'> <div class=callout> <p> <strong>Previously:</strong> <a href='writing-recipe.html'>Writing a Recipe</a> </p> </div> <span id=githubs> <h2>Running Kitchen Converge</h2> <a href='http://github.com/test-kitchen/kitchen-docs/edit/master/source/docs/getting-started/running-converge.md'> <div class='glyphicon glyphicon-pencil'></div> </a> </span> <p>Now that we have some code, let's let Test Kitchen run it for us on our Ubuntu 12.04 instance:</p>&#x000A;&#x000A;<pre class="highlight plaintext">$ kitchen converge default-ubuntu-1204&#x000A;-----&gt; Starting Kitchen (v1.0.0)&#x000A;-----&gt; Converging &lt;default-ubuntu-1204&gt;...&#x000A;       Preparing files for transfer&#x000A;       Preparing current project directory as a cookbook&#x000A;       Removing non-cookbook files before transfer&#x000A;-----&gt; Installing Chef Omnibus (true)&#x000A;       downloading https://www.opscode.com/chef/install.sh&#x000A;         to file /tmp/install.sh&#x000A;       trying wget...&#x000A;Downloading Chef  for ubuntu...&#x000A;Installing Chef&#x000A;Selecting previously unselected package chef.&#x000A;(Reading database ... 53291 files and directories currently installed.)&#x000A;Unpacking chef (from .../tmp.GUasmrcD/chef__amd64.deb) ...&#x000A;Setting up chef (11.8.0-1.ubuntu.12.04) ...&#x000A;Thank you for installing Chef!&#x000A;       Transfering files to &lt;default-ubuntu-1204&gt;&#x000A;[2013-11-30T21:55:45+00:00] INFO: Forking chef instance to converge...&#x000A;Starting Chef Client, version 11.8.0&#x000A;[2013-11-30T21:55:45+00:00] INFO: *** Chef 11.8.0 ***&#x000A;[2013-11-30T21:55:45+00:00] INFO: Chef-client pid: 1162&#x000A;[2013-11-30T21:55:46+00:00] INFO: Setting the run_list to ["recipe[git::default]"] from JSON&#x000A;[2013-11-30T21:55:46+00:00] INFO: Run List is [recipe[git::default]]&#x000A;[2013-11-30T21:55:46+00:00] INFO: Run List expands to [git::default]&#x000A;[2013-11-30T21:55:46+00:00] INFO: Starting Chef Run for default-ubuntu-1204&#x000A;[2013-11-30T21:55:46+00:00] INFO: Running start handlers&#x000A;[2013-11-30T21:55:46+00:00] INFO: Start handlers complete.&#x000A;Compiling Cookbooks...&#x000A;Converging 2 resources&#x000A;Recipe: git::default&#x000A;  * package[git] action install[2013-11-30T21:55:46+00:00] INFO: Processing package[git] action install (git::default line 1)&#x000A;&#x000A;    - install version 1:1.7.9.5-1 of package git&#x000A;&#x000A;  * log[Well, that was too easy] action write[2013-11-30T21:56:14+00:00] INFO: Processing log[Well, that was too easy] action write (git::default line 3)&#x000A;[2013-11-30T21:56:14+00:00] INFO: Well, that was too easy&#x000A;&#x000A;&#x000A;[2013-11-30T21:56:14+00:00] INFO: Chef Run complete in 28.139177847 seconds&#x000A;[2013-11-30T21:56:14+00:00] INFO: Running report handlers&#x000A;[2013-11-30T21:56:14+00:00] INFO: Report handlers complete&#x000A;Chef Client finished, 2 resources updated&#x000A;       Finished converging &lt;default-ubuntu-1204&gt; (1m3.91s).&#x000A;-----&gt; Kitchen is finished. (1m4.22s)&#x000A;</pre>&#x000A;<p>To quote our Chef run, that <strong>was</strong> too easy. If you are a Chef user then part of the output above should look familiar to you. Here's what happened at a high level:</p>&#x000A;&#x000A;<ul>&#x000A; <li>Chef was installed on the instance by performing an <a href="http://www.opscode.com/chef/install/">Omnibus package installation</a></li>&#x000A; <li>Your Git cookbook files and a minimal Chef Solo configuration were built and uploaded to the instance</li>&#x000A; <li>A Chef run was initiated using the run-list and node attributes specified in the <code>.kitchen.yml</code> file</li>&#x000A;</ul>&#x000A;&#x000A;<p>There's nothing to stop you from running this command again (or over-and-over for that matter) so, let's see what happens:</p>&#x000A;&#x000A;<pre class="highlight plaintext">$ kitchen converge default-ubuntu-1204&#x000A;-----&gt; Starting Kitchen (v1.0.0)&#x000A;-----&gt; Converging &lt;default-ubuntu-1204&gt;...&#x000A;       Preparing files for transfer&#x000A;       Preparing current project directory as a cookbook&#x000A;       Removing non-cookbook files before transfer&#x000A;       Transfering files to &lt;default-ubuntu-1204&gt;&#x000A;[2013-11-30T21:57:00+00:00] INFO: Forking chef instance to converge...&#x000A;Starting Chef Client, version 11.8.0&#x000A;[2013-11-30T21:57:00+00:00] INFO: *** Chef 11.8.0 ***&#x000A;[2013-11-30T21:57:00+00:00] INFO: Chef-client pid: 4142&#x000A;[2013-11-30T21:57:01+00:00] INFO: Setting the run_list to ["recipe[git::default]"] from JSON&#x000A;[2013-11-30T21:57:01+00:00] INFO: Run List is [recipe[git::default]]&#x000A;[2013-11-30T21:57:01+00:00] INFO: Run List expands to [git::default]&#x000A;[2013-11-30T21:57:01+00:00] INFO: Starting Chef Run for default-ubuntu-1204&#x000A;[2013-11-30T21:57:01+00:00] INFO: Running start handlers&#x000A;[2013-11-30T21:57:01+00:00] INFO: Start handlers complete.&#x000A;Compiling Cookbooks...&#x000A;Converging 2 resources&#x000A;Recipe: git::default&#x000A;  * package[git] action install[2013-11-30T21:57:01+00:00] INFO: Processing package[git] action install (git::default line 1)&#x000A; (up to date)&#x000A;  * log[Well, that was too easy] action write[2013-11-30T21:57:01+00:00] INFO: Processing log[Well, that was too easy] action write (git::default line 3)&#x000A;[2013-11-30T21:57:01+00:00] INFO: Well, that was too easy&#x000A;&#x000A;&#x000A;[2013-11-30T21:57:01+00:00] INFO: Chef Run complete in 0.069998015 seconds&#x000A;[2013-11-30T21:57:01+00:00] INFO: Running report handlers&#x000A;[2013-11-30T21:57:01+00:00] INFO: Report handlers complete&#x000A;Chef Client finished, 1 resources updated&#x000A;       Finished converging &lt;default-ubuntu-1204&gt; (0m1.67s).&#x000A;-----&gt; Kitchen is finished. (0m1.99s)&#x000A;</pre>&#x000A;<p>That ran a <strong>lot</strong> faster didn't it? Here's what happened this time:</p>&#x000A;&#x000A;<ul>&#x000A; <li>Test Kitchen found that Chef was present and installed so skipped a re-installation.</li>&#x000A; <li>The same Chef cookbook files and Chef Solo configuration was uploaded to the instance. Test Kitchen is optimizing for <strong>freshness of code and configuration over speed</strong>. Although we all like speed wherever possible.</li>&#x000A; <li>A Chef run is initiated and runs very quickly as we are in the desired state.</li>&#x000A;</ul>&#x000A;&#x000A;<table>&#x000A; <tbody>&#x000A; <tr>&#x000A; <td> </td>&#x000A; <td>Pro-Tip</td>&#x000A; </tr>&#x000A; <tr>&#x000A; <td> </td>&#x000A; <td>A lot of time and effort has gone into ensuring that the exit code of Test Kitchen is always appropriate. Here is the Kitchen Command Guarantee:</td>&#x000A; </tr>&#x000A; <tr>&#x000A; <td> </td>&#x000A; <td>1. I will always exit with code <strong>0</strong> if my operation was successful.</td>&#x000A; </tr>&#x000A; <tr>&#x000A; <td> </td>&#x000A; <td>2. I will always exit with a non-zero code if <strong>any</strong> part of my operation was not successful.</td>&#x000A; </tr>&#x000A; <tr>&#x000A; <td> </td>&#x000A; <td>3. Any behavior to the contrary <strong>is a bug</strong>.</td>&#x000A; </tr>&#x000A; <tr>&#x000A; <td> </td>&#x000A; <td>This exit code behavior is a fundamental prerequisite for any tool working in a Continuous Integration (CI) environment.</td>&#x000A; </tr>&#x000A; </tbody>&#x000A;</table>&#x000A;&#x000A;<p>Let's check the status of our instance:</p>&#x000A;&#x000A;<pre class="highlight plaintext">$ kitchen list&#x000A;Instance             Driver   Provisioner  Last Action&#x000A;default-ubuntu-1204  Vagrant  ChefSolo     Converged&#x000A;</pre>&#x000A;<p>A clean converge run, success! Let's commit our production code and move on:</p>&#x000A;&#x000A;<pre class="highlight plaintext">$ git add recipes/default.rb&#x000A;$ git commit -m "Implemented the default recipe, woot woot."&#x000A;[master 4d54a16] Implemented the default recipe, woot woot.&#x000A; 1 file changed, 3 insertions(+)&#x000A;</pre>&#x000A; <hr> <div id=suggestions> <div class=row> <div class='col-sm-7 col-md-7 pull-left'> <p></p> </div> <div class='col-sm-5 col-md-5 pull-right'> <div class='maximum-button red full-width'> <a href='manually-verifying.html'>Manually verifying</a> <i class='glyphicon glyphicon-circle-arrow-right'></i> </div> </div> </div> </div> </div> <div class='col-sm-4 col-md-4'> <ul class=sections> <li> <a href='index.html'>Introduction</a> </li> <li> <a href='installing.html'>Installing Test Kitchen</a> </li> <li> <a href='getting-help.html'>Getting Help</a> </li> <li> <a href='creating-cookbook.html'>Creating a Cookbook</a> </li> <li> <a href='writing-recipe.html'>Writing a Recipe</a> </li> <li class=bookmark> <i class='glyphicon glyphicon-bookmark'></i> <p>Running Kitchen Converge</p> </li> <li> <a href='manually-verifying.html'>Manually Verifying</a> </li> <li> <a href='writing-test.html'>Writing a Test</a> </li> <li> <a href='running-verify.html'>Running Kitchen Verify</a> </li> <li> <a href='running-test.html'>Running Kitchen Test</a> </li> <li> <a href='adding-platform.html'>Adding a Platform</a> </li> <li> <a href='dynamic-configuration.html'>Dynamic Configuration</a> </li> <li> <a href='fixing-converge.html'>Fixing Converge</a> </li> <li> <a href='adding-feature.html'>Adding a New Feature</a> </li> <li> <a href='adding-suite.html'>Adding a Suite</a> </li> <li> <a href='writing-server-test.html'>Writing a Server Test</a> </li> <li> <a href='writing-failing-recipe.html'>Writing a Failing Recipe</a> </li> <li> <a href='adding-dependency.html'>Adding a Dependency</a> </li> <li> <a href='backfilling-platforms.html'>Backfilling Platforms</a> </li> <li> <a href='next-steps.html'>Next Steps</a> </li> </ul> </div> </div> </div> </body> <script src="../../js/vendor/modernizr-2.6.2.min-76c5a590.js"></script> <script src="../../js/all-126c4e27.js"></script> <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');
    
    ga('create', 'UA-39138312-3', 'kitchen.ci');
    ga('send', 'pageview');
  </script> 
<!-- Mirrored from kitchen.ci/docs/getting-started/running-converge by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 17 Aug 2015 23:12:38 GMT -->
</html>